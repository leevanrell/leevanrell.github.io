<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="shortcut icon" type="image/png" href="/assets/favicon.png">
<title>MagicMirror Build</title>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>MagicMirror Build | Lee Vanrell</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="MagicMirror Build" />
<meta name="author" content="lee vanrell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Here’s a little project I’ve worked on a few weeks ago. It’s a semi-intelligent magic mirror I put together. It was relatively cheap to put together since I got the monitor for free and already had a pi lying around." />
<meta property="og:description" content="Here’s a little project I’ve worked on a few weeks ago. It’s a semi-intelligent magic mirror I put together. It was relatively cheap to put together since I got the monitor for free and already had a pi lying around." />
<link rel="canonical" href="https://leevanrell.github.io/python/raspberrypi/2020/01/30/MagicMirror-build/" />
<meta property="og:url" content="https://leevanrell.github.io/python/raspberrypi/2020/01/30/MagicMirror-build/" />
<meta property="og:site_name" content="Lee Vanrell" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-30T19:10:12-06:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"MagicMirror Build","dateModified":"2020-01-30T19:10:12-06:00","datePublished":"2020-01-30T19:10:12-06:00","author":{"@type":"Person","name":"lee vanrell"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leevanrell.github.io/python/raspberrypi/2020/01/30/MagicMirror-build/"},"description":"Here’s a little project I’ve worked on a few weeks ago. It’s a semi-intelligent magic mirror I put together. It was relatively cheap to put together since I got the monitor for free and already had a pi lying around.","url":"https://leevanrell.github.io/python/raspberrypi/2020/01/30/MagicMirror-build/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
</head>

<body>
  <main class="container">
    <section class="about">
      <a href="/"><img src="/assets/portfolio.png" alt="Lee Vanrell"></a>
      <h2 id="title">
        <a href="/">Lee Vanrell</a>
      </h2>
      <p class="tagline">Software Engineer</p>
      <ul class="social"><a href="https://github.com/leevanrell">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/leevanrell">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><a href="https://twitter.com/lee_vanrell">
          <li>
            <i class="icon-twitter-squared"></i>
          </li>
        </a></ul><nav class="navigation">
        <ul>
          
          <li>
            <a href="/about">About Me</a>
          </li>
          
          <li>
            <a href="/bookmarks">Bookmarks</a>
          </li>
          
          <li>
            <a href="/feed.xml">Subscribe</a>
          </li>
          
        </ul>
      </nav><p>&copy;
        2020</p><div>
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" id="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
      <script type="text/javascript" src="/assets/js/darkmode.js"></script></section>
    <section class="content">
      <div class="post-container">
  <a class="post-link" href="/python/raspberrypi/2020/01/30/MagicMirror-build/">
    <h2 class="post-title">MagicMirror Build</h2>
  </a>
  <div class="post-meta">
    <div class="post-date"><i class="icon-calendar"></i>Jan 30, 2020</div><ul class="post-categories"><li>Python</li><li>RaspberryPi</li></ul></div>
  <div class="post">
    <p>Here’s a little project I’ve worked on a few weeks ago. It’s a semi-intelligent magic mirror I put together. It was relatively cheap to put together since I got the monitor for free and already had a pi lying around.</p>

<p>For the frame, I used this <a href="https://amzn.to/2uCL8Rk">frame</a> (though when I bought it was for $100, not $150 so you may want to look elsewhere).</p>

<p>The first thing to do is to make sure that the monitor works; it saves time and heartbreak. Then remove the bezel from the monitor and be careful of any ribbon cables connected to the monitor and the bezel.
For my monitor, the display was divided into two parts physically, the power supply/input logic board, and the display itself. So to keep them together I applied a hefty amount of duck tape. Because who has power tools?</p>

<p>This is the final product somewhat:</p>

<p><img src="/assets/img/magicmirror/front.jpg" alt="Lowkey just a selfie" /></p>

<p><img src="/assets/img/magicmirror/back.jpg" alt="Back" /></p>

<p>You can’t even tell its held entirely together by duck tape!</p>

<p>I’ll explain the wizardry that is connected to the pi in a second.
To set up the magic mirror, the process is pretty automated see <a href="https://github.com/sdetweil/MagicMirror_scripts">here</a>.</p>

<p>For customizations, I like to install <a href="https://github.com/nigel-daniels/MMM-3Day-Forecast">3Day forecast</a>. That’s pretty much it, since, I’ve failed repeatedly to get carousel setup. I do recommend tweaking the CSS to correct for the screen not taking up the entire mirror’s real-estate.</p>

<p>Now here’s where things get interesting. I’ve configured my Mirror to turn off at around 9 pm and back on at 6a m automatically. Here’s how:</p>

<p>First, for hardware, you’ll need a <a href="https://amzn.to/2RWC15Z">photoresistor</a> and a <a href="https://amzn.to/37AHBRP">relay</a>. For tools, you’ll need a soldering iron and power of will.
I’ve wired a photoresistor to the pi that sends a low signal whenever it detects light above a certain threshold and vice versa when it doesn’t. The threshold is can be adjusted with a screw in the blue housing. I’ve used this in conjunction with a relay that has the control side wired to the pi and the operating side connected to a ribbon cable that was connected to the control board for the on/off buttons. Wiring is relatively simple, I’ve used a miniature breadboard to distribute power to the rest of the components, but isn’t necessary.</p>

<p>I first figured out which pins on the control board need to be shorted to turn the display on &amp; off.
I initially planned to solder to the board, but then realized that I can scrape the plastic off of the side of the ribbon cable connecting to the board and solder directly to that.</p>

<p><img src="/assets/img/magicmirror/solder.jpg" alt="sketchy solder" /></p>

<p>It’s sketchy but it works.</p>

<p>Then I plugged the soldered wires into the operating side of the relay.
Here’s the code for actually toggling the pi on/off</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/env python

import RPi.GPIO as GPIO
import sys
from time import sleep

GPIO.setmode(GPIO.BCM)

toggle = sys.argv[1]

GPIO.setup(23, GPIO.OUT)
GPIO.setup(24, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

#GPIO is high when disp is off and GPIO low when off, inverting because that seems more logical
light_state = not GPIO.input(24) 

#will flip relay if told to turn on display and display is off or 
#if told to turn off the display and the display is on
if (toggle == "turnon" and light_state == GPIO.LOW) or (toggle == "turnoff" and light_state == GPIO.HIGH):
	GPIO.output(23, GPIO.HIGH)
	sleep(0.5)
	GPIO.output(23, GPIO.LOW)
	sleep(1.5) # wait for display to turn off
GPIO.cleanup()
</code></pre></div></div>

<p>I know. Its hot garbage. But it’s my garbage.</p>

<p>You can drop this script in your home directory. Make it executable with chmod.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ chmod +x script.py
</code></pre></div></div>
<p>Then run crontab to create a cron job entry.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ crontab -e
</code></pre></div></div>

<p>Here are my entries:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0	5	*	*	*	/home/pi/script.py turnon
0	21	*	*	*	/home/pi/script.py turnoff
</code></pre></div></div>

<p>What’s cool about this solution is that it’s easily hackable enough that you can make a webserver to toggle it on/off aswell. I’ve made a quick example of a flask server controlling the mirror:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#/usr/bin/python3

from flask import Flask,render_template
from time import sleep
import RPi.GPIO as GPIO
import subprocess

GPIO.setmode(GPIO.BCM)
GPIO.setup(23, GPIO.OUT)
GPIO.setup(24, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

# configuration
DEBUG = True

# instantiate the app
app = Flask(__name__)
app.config.from_object(__name__)

@app.route('/', methods=['GET'])
def index():
	light_state = not GPIO.input(24) 
	if light_state == 0:
		return render_template('index.html', color="black", state="Turn on")
	else:
		return render_template('index.html', color="white", state="Turn off")

@app.route('/test', methods=["GET"])
def button():
	light_state = not GPIO.input(24) 
	if light_state == 1:
		toggle()
		return render_template('index.html', color="black", state="Turn on")
	else:
		toggle()
		return render_template('index.html', color="white", state="Turn off")

def toggle():
	GPIO.output(23, GPIO.HIGH)
	sleep(0.5)
	GPIO.output(23, GPIO.LOW)
	sleep(1.5) # wait for display to turn off

if __name__ == '__main__':
	mirror_status = 0
	app.run(host='0.0.0.0')
	GPIO.cleanup()
</code></pre></div></div>

<p>There are other things you can do like have it toggle on whenever it senses motion or lack thereof 
The rest of the code is <a href="https://github.com/leevanrell/mirror-controller.git">here</a>.</p>

<p>Finis.</p>

  </div></div>

    </section>
  </main>
  <script src="/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/assets/js/search.js"></script>
  
</body>

</html>
